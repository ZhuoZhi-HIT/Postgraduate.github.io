---
title: Modeling and verification of four-rotor UAV flight control system
layout: post
categories: ''
tags: ''
img: Flight_control_model.PNG
---
## Introduce
In order to improve the reliability of low-cost quadrotor UAV flight control system, designed a flight control system and proposed a modeling method. In this method, Newton-Euler formula is involved to set up the kinematic equation. The Mahony filter is used for sensor data fusion and attitude algorithm. A cascade proportion integration differentiation controller with integral separation is designed to control the attitude. Experimental data are compared between the simulation model and the real platform.  The usability of the model is verified and the reliability of the real flight control system can be evaluated by the formulated model.
## The simulation model
The model is built by Simulink in Matlab. The model mainly includes three sub-models, the attitude control model, the motor dynamics model and the rigid body dynamics model. The following is a brief introduction to the algorithms and principles used.
### Establishment of kinematic equation
The external forces and moments experienced by the quadrotor UAV include three items.

(1)The gravity. 

(2) Lift Fi (i=1, 2, 3, 4) generated by rotation of rotors.

(3) Torsional Mi (i=1, 2, 3, 4) produced by rotor rotation.

The linear motion equation is defined by 

$$\[m\ddot r = \left[ \begin{array}{c}
0\\
0\\
 - mg
\end{array} \right] + Rt\left[ \begin{array}{c}
0\\
0\\
\sum {{F_i}} 
\end{array} \right]\]










## Intuition
The intuition behind Learned Bloom Filter is that there are two main differences between Learned Bloom Filter and general classification problem. The first thing is that for LBT, it has all the positive samples trained during the training step, while for general task, new posi-tive samples could occur in test set. Therefore, for LBT, we should try to make the decision boundary closer to the positive samples. The second difference is that the aim for LBT is to minimize the false negative rate with an ex-tremely low false positive rate. However, the general task just minimizes the loss of incorrect prediction. Based on the second difference, we then propose Unbalanced Focal Loss and Threshold Focal Loss. 

## Unbalanced Focal Loss
The formula is as below.
![Unbalanced Focal]({{site.baseurl}}/assets/img/unbalanced.png)
![Picture]({{site.baseurl}}/assets/img/unbalanced_pic.jpg)

## Threshold Focal Loss
The formula is as below.
![Threshold Focal]({{site.baseurl}}/assets/img/threshold.png)
![Picture]({{site.baseurl}}/assets/img/threshold_pic.jpg)

## Result
Unbalanced focal loss could decrease the memory needed by __12.19%__ , and threshold focal loss could decrease it by __16.72%__ , which demonstrate the promising point to design loss function from a view of probability theory.
![Result1]({{site.baseurl}}/assets/img/result_f.png)
![Result2]({{site.baseurl}}/assets/img/result_t.png)